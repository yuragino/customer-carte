<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>花火大会統計情報</title>
  <!-- Custom Script -->
  <script type="module" src="../assets/js/hanabi/statistics.js"></script>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>
  <!-- Styles -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/sanitize.css">
  <link rel="stylesheet" href="../assets/css/common/layout.css">
  <link rel="stylesheet" href="../assets/css/common/statistics.css">
</head>

<body x-data="app">
  <header class="header">
    <div class="header-inner">
      <h1 class="header-title"><a href="../index.html">着付予約管理</a></h1>
      <div class="header-controls">
        <input type="number" min="2025" max="2060" step="1" x-model.number="selectedYear" @change="changeYear" class="text-black">
        <span>花火大会</span>
      </div>
      <nav class="header-nav">
        <a :href="`./statistics.html?year=${selectedYear}`" class="active">統計情報</a>
        <a :href="`./index.html?year=${selectedYear}`">予約一覧</a>
        <a :href="`./image-list.html?year=${selectedYear}`">画像一覧</a>
        <a :href="`./form.html?year=${selectedYear}`" x-show="user">新規登録</a>
      </nav>
    </div>
  </header>

  <!-- 男女別統計 -->
  <section class="stats-grid">
    <template x-for="stat in dressingStats" :key="stat.label">
      <div class="stats-box">
        <h3 x-text="stat.label"></h3>
        <p>平均: <span x-text="stat.avg"></span></p>
        <p>最短: <span x-text="stat.min"></span></p>
        <p>最長: <span x-text="stat.max"></span></p>
      </div>
    </template>
  </section>

  <!-- 顧客別一覧 -->
  <main>
    <table class="stats-table">
      <thead>
        <tr>
          <th>代表者名</th>
          <th>個人名</th>
          <th>担当スタッフ</th>
          <th>受付時間</th>
          <th>着付開始</th>
          <th>着付完了</th>
          <th>見送り完了</th>
          <th>着付所要時間</th>
          <th>トータル</th>
        </tr>
      </thead>
      <tbody>
        <tr x-show="customers.length === 0">
          <td colspan="9" class="no-data">該当するデータがありません。</td>
        </tr>
        <template x-for="customer in customers">
          <tr>
            <td x-text="customer.representative"></td>
            <td :class="customer.gender === 'male' ? 'gender-male' : 'gender-female'" x-text="customer.name"></td>
            <td x-text="(customer.staff || []).join(', ')"></td>
            <td x-text="formatTimestamp(customer.receptionStartedAt)"></td>
            <td x-text="formatTimestamp(customer.dressingStartedAt)"></td>
            <td x-text="formatTimestamp(customer.dressingCompletedAt)"></td>
            <td x-text="formatTimestamp(customer.sendOffCompletedAt)"></td>
            <td x-text="customer.dressingTime ?? '--'"></td>
            <td x-text="customer.totalTime ?? '--'"></td>
          </tr>
        </template>
      </tbody>
    </table>

  </main>
</body>

</html>
